/**
 * copyright: Olivier Combe (https://github.com/ocombe/ocModal)
 */
(function(){"use strict";var e=angular.module("oc.modal",[]);e.factory("$ocModal",["$rootScope","$controller","$location","$timeout","$compile",function(e,t,n,r,i){var s=angular.element(document.body),o,u,a={},f=[],l;angular.element(document).on("keyup",function(t){if(t.keyCode==27&&f.length>0){t.stopPropagation();e.$apply(function(){c.closeOnEsc(f[f.length-1])})}});var c={waitingForOpen:false,getOpenedModals:function(){return f},register:function(e){a[e.id||"_default"]=e},remove:function(e){delete a[e||"_default"]},open:function(n){if(typeof n==="string"){if(n.match("<")){n={template:n}}else{n={url:n}}}if(typeof o==="undefined"){u=angular.element('<div role="dialog" tabindex="-1" class="modal fade in"><div class="modal-backdrop fade in"></div></div>');o=angular.element('<div class="modal-wrapper fade-in"></div>');o.append(u);s.append(o);var h=u.children()[0];u.on("click.modal",function(t){if(t.target===h){e.$apply(function(){c.closeOnEsc()})}t.stopPropagation()})}var p=a[n.id||"_default"];if(!p){u.append(i('<div oc-modal="'+(n.id?n.id:"_default")+'"></div>')(e));r(function(){c.open(n)});return}else if(p&&f.indexOf(n.id||"_default")!==-1){c.waitingForOpen=true;c.close(n.id);r(function(){c.open(n)});return}if(!c.waitingForOpen){if(f.length===0){l=document.body.style.overflow;document.body.style.overflow="hidden";o.css("display","block")}else{for(var d=0,v=f.length;d<v;d++){var m=a[f[d]].$element;a[f[d]].baseZIndex=m.css("z-index");m.css("z-index","-1")}}}c.waitingForOpen=false;f.push(n.id||"_default");p.params=n;p.$scope.modalShow=true;p.$scope.customClass=p.params.cls;if(typeof p.params.onOpen==="function"){p.params.onOpen()}var g=p.$scope.$on("$includeContentLoaded",function(e){if(p.params.init&&!p.params.isolate){angular.extend(e.targetScope,p.params.init,true)}if(typeof p.params.controller==="string"){t(p.params.controller,{$scope:e.targetScope,$init:p.params.init})}g()});if(p.params.template){p.$scope.modalTemplate=p.params.template}else if(p.params.url){p.$scope.modalUrl=p.params.url}else{throw"You need to define a template or an url";return}if(typeof callback==="function"){p.$scope.callbacksList.push(callback)}},closeOnEsc:function(e){if(a[e||f[f.length-1]].params.closeOnEsc!==false){c.close(e)}},close:function(e){var t;if(typeof e==="string"&&f.indexOf(e)!==-1){t=Array.prototype.slice.call(arguments,1)}else{t=arguments}if(typeof e==="undefined"||f.indexOf(e)===-1){e=f[f.length-1]}var n=a[e||f[f.length-1]];if(n&&n.$scope.modalShow===true){n.$scope.modalShow=false;n.$element.remove();n.callbacksList=[];f.splice(f.indexOf(e||f[f.length-1]),1);if(f.length===0){r(function(){if(!c.waitingForOpen){document.body.style.overflow=l;o.css("display","none")}})}else{var i=a[f[f.length-1]];i.$element.css("z-index",i.baseZIndex)}if(typeof n.params.onClose==="function"){n.params.onClose.apply(undefined,t)}}}};return c}]);e.directive("ocModal",["$ocModal","$compile","$timeout",function(e,t,n){return{restrict:"AE",replace:true,scope:true,template:'<div class="modal-dialog {{customClass}}" ng-show="modalShow">'+'<div class="modal-content" ng-if="modalTemplate"></div>'+'<div class="modal-content" ng-include="modalUrl"></div>'+"</div>",link:function(r,i,s){var o=i.find("[role=dialog]"),u=s.ocModal,a;r.closeModal=function(){var t=Array.prototype.slice.call(arguments);t.unshift(u);e.close.apply(undefined,t)};e.register({id:u,$scope:r,$element:i});i.on("$destroy",function(){e.remove(u)});r.$watch("modalTemplate",function(e,n){if(typeof e!=="undefined"){if(!a){a=angular.element(i.children()[0])}a.append(t(e)(r));r.$emit("$includeContentLoaded")}})}}}]);e.directive("ocModalOpen",["$ocModal",function(e){return{restrict:"A",require:"?modal",link:function(t,n,r){n.on("click touchstart",function(n){n.preventDefault();n.stopPropagation();var i=t.$new();var s=i.$eval(r.ocModalOpen);if(s){if(typeof s==="number"){s={url:r.ocModalOpen}}else if(typeof s==="string"){s={url:s}}if(!s.url){throw"You need to set the modal url"}t.$apply(function(){e.open(s)})}})}}}]);e.directive("ocModalClose",["$ocModal",function(e){return{restrict:"A",require:"?modal",link:function(t,n,r){n.on("click touchstart",function(n){n.preventDefault();n.stopPropagation();t.$apply(function(){if(r.ocModalClose){var n=t.$new().$eval(r.ocModalClose)}e.close(n)})})}}}])})()
