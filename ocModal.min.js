/**
 * copyright: Olivier Combe (https://github.com/ocombe/ocModal)
 */
(function(){"use strict";var e=angular.module("oc.modal",[]);e.factory("$ocModal",["$rootScope","$controller","$location","$timeout","$compile",function(e,t,n,r,i){var s=angular.element(document.body),o,u,a={},f=[],l;angular.element(document).on("keyup",function(t){if(t.keyCode==27&&f.length>0){t.stopPropagation();e.$apply(function(){c.closeOnEsc(f[f.length-1])})}});var c={register:function(e){a[e.id||"_default"]=e},remove:function(e){delete a[e||"_default"]},open:function(n){if(typeof n==="string"){if(n.match("<")){n={template:n}}else{n={url:n}}}if(typeof o==="undefined"){u=angular.element('<div role="dialog" tabindex="-1" class="modal fade in"><div class="modal-backdrop fade in"></div></div>');o=angular.element('<div class="modal-wrapper fade-in"></div>');o.append(u);s.append(o)}var h=a[n.id||"_default"];if(!h){u.append(i('<div oc-modal="'+(n.id?n.id:"_default")+'"></div>')(e));r(function(){c.open(n)});return}else if(h&&f.indexOf(n.id||"_default")!==-1){c.close(n.id);r(function(){c.open(n)});return}if(f.length===0){l=document.body.style.overflow;o.css("display","block")}else{for(var p=0,d=f.length;p<d;p++){var v=a[f[p]].$element;a[f[p]].baseZIndex=v.css("z-index");v.css("z-index","-1")}}f.push(n.id||"_default");h.params=n;h.$scope.modalShow=true;h.$scope.customClass=h.params.cls;if(typeof h.params.onOpen==="function"){h.params.onOpen()}var m=h.$scope.$on("$includeContentLoaded",function(e){if(h.params.init&&!h.params.isolate){angular.extend(e.targetScope,h.params.init,true)}if(typeof h.params.controller==="string"){t(h.params.controller,{$scope:e.targetScope,$init:h.params.init})}m()});if(h.params.template){h.$scope.modalTemplate=h.params.template}else if(h.params.url){h.$scope.modalUrl=h.params.url}else{throw"You need to define a template or an url";return}if(typeof callback==="function"){h.$scope.callbacksList.push(callback)}},closeOnEsc:function(e){if(a[e||"_default"].params.closeOnEsc!==false){c.close(e)}},close:function(e,t){if(typeof t==="undefined"&&typeof e!=="string"||f.indexOf(e)===-1){t=arguments;e=f[f.length-1]}var n=a[e||f[f.length-1]];if(n&&n.$scope.modalShow===true){n.$scope.modalShow=false;n.callbacksList=[];f.splice(f.indexOf(e||f[f.length-1]),1);if(f.length===0){document.body.style.overflow=l;o.css("display","none")}else{var r=a[f[f.length-1]];r.$element.css("z-index",r.baseZIndex)}if(typeof n.params.onClose==="function"){n.params.onClose.apply(undefined,t)}}}};return c}]);e.directive("ocModal",["$ocModal","$compile","$timeout",function(e,t,n){return{restrict:"AE",replace:true,scope:true,template:'<div class="modal-dialog {{customClass}}" ng-show="modalShow">'+'<div class="modal-content" ng-if="modalTemplate"></div>'+'<div class="modal-content" ng-include="modalUrl"></div>'+"</div>",link:function(r,i,s){var o=i.find("[role=dialog]"),u=s.ocModal,a;r.closeModal=function(){e.close(u,arguments)};e.register({id:u,$scope:r,$element:i});i.on("$destroy",function(){e.remove(u)});r.$watch("modalTemplate",function(e,n){if(typeof e!=="undefined"){if(!a){a=angular.element(i.children()[0])}a.append(t(e)(r));r.$emit("$includeContentLoaded")}});r.$watch("modalShow",function(t){if(typeof t!=="undefined"){if(t){document.body.style.overflow="hidden";o.on("click.modal",function(t){if(t.target===o[0]){r.$apply(function(){e.closeOnEsc(u)})}})}else{i.remove();o.off("click.modal")}}})}}}]);e.directive("ocModalOpen",["$ocModal",function(e){return{restrict:"A",require:"?modal",link:function(t,n,r){n.on("click touchstart",function(n){n.preventDefault();n.stopPropagation();var i=t.$new();var s=i.$eval(r.ocModalOpen);if(s){if(typeof s==="number"){s={url:r.ocModalOpen}}else if(typeof s==="string"){s={url:s}}if(!s.url){throw"You need to set the modal url"}t.$apply(function(){e.open(s)})}})}}}]);e.directive("ocModalClose",["$ocModal",function(e){return{restrict:"A",require:"?modal",link:function(t,n,r){n.on("click touchstart",function(n){n.preventDefault();n.stopPropagation();t.$apply(function(){if(r.ocModalClose){var n=t.$new().$eval(r.ocModalClose)}e.close(n)})})}}}])})()