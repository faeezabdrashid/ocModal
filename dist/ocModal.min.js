/**
 * ocModal - An angularJS modal directive / service
 * @version v0.1.0
 * @link https://github.com/ocombe/ocModal
 * @license MIT
 * @author Olivier Combe <olivier.combe@gmail.com>
 */
!function(){"use strict";var e=angular.module("oc.modal",[]);e.factory("$ocModal",["$rootScope","$controller","$location","$timeout","$compile","$sniffer",function(e,o,n,a,t,l){var i,r=angular.element(document.body),c=angular.element('<div role="dialog" tabindex="-1" class="modal"><div class="modal-backdrop"></div></div>'),s=angular.element('<div class="modal-wrapper"></div>'),d={},p=[];s.css("display","none"),s.append(c),r.append(s);var u=c.children()[0];c.on("click.modal",function(o){o.target===u&&e.$apply(function(){v.closeOnEsc()}),o.stopPropagation()});var m=function(e){var o=0,n=angular.isString(e)?e.split(/\s*,\s*/):[];return angular.forEach(n,function(e){o=Math.max(parseFloat(e)||0,o)}),o},f=function(e){var o=0;if(l.transitions||l.animations){var n="animation",a="transition",t=l.vendorPrefix+"Animation",i=l.vendorPrefix+"Transition",r="Duration",c="Delay",s="IterationCount",d=1;angular.forEach(e,function(e){if(e.nodeType==d){var l=window.getComputedStyle(e)||{},p=Math.max(m(l[a+c]),m(l[i+c])),u=Math.max(m(l[n+c]),m(l[t+c])),f=Math.max(m(l[a+r]),m(l[i+r])),v=Math.max(m(l[n+r]),m(l[t+r]));v>0&&(v*=Math.max(parseInt(l[n+s])||0,parseInt(l[t+s])||0,1)),o=Math.max(u+v,p+f,o)}})}return 1e3*o};angular.element(document).on("keyup",function(o){27==o.keyCode&&p.length>0&&(o.stopPropagation(),e.$apply(function(){v.closeOnEsc(p[p.length-1])}))});var v={waitingForOpen:!1,getOpenedModals:function(){return p},register:function(e){d[e.id||"_default"]=e},remove:function(e){delete d[e||"_default"]},open:function(n){"string"==typeof n&&(n=n.match("<")?{template:n}:{url:n});var l=d[n.id||"_default"];if(!l)return c.append(t('<div oc-modal="'+(n.id?n.id:"_default")+'"></div>')(e)),void a(function(){v.open(n)});if(l&&-1!==p.indexOf(n.id||"_default"))return v.waitingForOpen=!0,v.close(n.id),void a(function(){v.open(n)});if(!v.waitingForOpen)if(0===p.length)i=document.body.style.overflow,document.body.style.overflow="hidden",s.css("display","block");else for(var u=0,m=p.length;m>u;u++){var f=d[p[u]].$element;d[p[u]].baseZIndex=f.css("z-index"),f.css("z-index","-1")}v.waitingForOpen=!1,p.push(n.id||"_default"),l.params=n,l.$scope.customClass=l.params.cls,e.$digest(),r[0].offsetWidth,a(function(){l.$scope.modalShow=!0},100),"function"==typeof l.params.onOpen&&l.params.onOpen();var g=l.$scope.$on("$includeContentLoaded",function(e){l.params.init&&!l.params.isolate&&angular.extend(e.targetScope,l.params.init,!0),"string"==typeof l.params.controller&&o(l.params.controller,{$scope:e.targetScope,$init:l.params.init,$ocModalParams:l.params}),g()});if(l.params.template)l.$scope.modalTemplate=l.params.template;else{if(!l.params.url)throw"You need to define a template or an url";l.$scope.modalUrl=l.params.url}"function"==typeof callback&&l.$scope.callbacksList.push(callback)},closeOnEsc:function(e){d[e||p[p.length-1]].params.closeOnEsc!==!1&&v.close(e)},close:function(e){var o;o="string"==typeof e&&-1!==p.indexOf(e)?Array.prototype.slice.call(arguments,1):arguments,("undefined"==typeof e||-1===p.indexOf(e))&&(e=p[p.length-1]);var n=d[e||p[p.length-1]];if(n&&n.$scope.modalShow===!0){var t=f(angular.element(n.$element[0].querySelector(".modal-content")));if(a(function(){n.$scope.modalShow=!1,a(function(){n.$element.remove()},t)}),n.callbacksList=[],p.splice(p.indexOf(e||p[p.length-1]),1),0===p.length)a(function(){v.waitingForOpen||(document.body.style.overflow=i,s.css("display","none"))},t);else{var l=d[p[p.length-1]];l.$element.css("z-index",l.baseZIndex)}"function"==typeof n.params.onClose&&n.params.onClose.apply(void 0,o)}}};return v}]),e.directive("ocModal",["$ocModal","$compile","$timeout",function(e,o){return{restrict:"AE",replace:!0,scope:!0,template:'<div class="modal-dialog"><div class="modal-content {{customClass}}" ng-class="{opened: modalShow}" ng-if="modalTemplate"></div><div class="modal-content {{customClass}}" ng-class="{opened: modalShow}" ng-include="modalUrl"></div></div>',link:function(n,a,t){var l,i=(a.find("[role=dialog]"),t.ocModal);n.closeModal=function(){var o=Array.prototype.slice.call(arguments);o.unshift(i),e.close.apply(void 0,o)},e.register({id:i,$scope:n,$element:a}),a.on("$destroy",function(){e.remove(i)}),n.$watch("modalTemplate",function(e){"undefined"!=typeof e&&(l||(l=angular.element(a.children()[0])),l.append(o(e)(n)),n.$emit("$includeContentLoaded"))})}}}]),e.directive("ocModalOpen",["$ocModal",function(e){return{restrict:"A",require:"?modal",link:function(o,n,a){n.on("click touchstart",function(n){n.preventDefault(),n.stopPropagation();var t=o.$new(),l=t.$eval(a.ocModalOpen);if(l){if("number"==typeof l?l={url:a.ocModalOpen}:"string"==typeof l&&(l={url:l}),!l.url)throw"You need to set the modal url";o.$apply(function(){e.open(l)})}})}}}]),e.directive("ocModalClose",["$ocModal",function(e){return{restrict:"A",require:"?modal",link:function(o,n,a){n.on("click touchstart",function(n){n.preventDefault(),n.stopPropagation(),o.$apply(function(){if(a.ocModalClose)var n=o.$new().$eval(a.ocModalClose);e.close(n)})})}}}])}();